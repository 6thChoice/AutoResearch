# Claude Code Docker å®¹å™¨äº¤äº’ç³»ç»Ÿ

åŸºäº Docker å®¹å™¨çš„ Claude Code è‡ªåŠ¨åŒ–æ‰§è¡Œç³»ç»Ÿï¼Œæ”¯æŒ GPU åŠ é€Ÿã€è·¨æ™ºèƒ½ä½“è®°å¿†ç®¡ç†ã€ç»“æ„åŒ–æŠ¥å‘Šç”Ÿæˆã€‚

## ç‰¹æ€§

- **GPU æ”¯æŒ**ï¼šåŸºäº NVIDIA CUDA 12.1 é•œåƒï¼Œæ”¯æŒæ·±åº¦å­¦ä¹ ä»»åŠ¡
- **å¼‚æ­¥é€šä¿¡**ï¼šé€šè¿‡ MD æ–‡ä»¶ä¼ é€’æŒ‡ä»¤å’ŒæŠ¥å‘Šï¼Œæ”¯æŒå¤šç³»ç»Ÿå¯¹æ¥
- **å®Œæ•´æ—¥å¿—**ï¼šè‡ªåŠ¨è®°å½• AI æ€è€ƒè¿‡ç¨‹(thinking)ã€å·¥å…·è°ƒç”¨(tool_use)ã€ä¼šè¯ç»Ÿè®¡
- **è·¨æ™ºèƒ½ä½“è®°å¿†**ï¼šAGENT_MISSION.md ä»»åŠ¡æ‰‹å†Œ + ADR æ¶æ„å†³ç­–è®°å½•
- **ç»“æ„åŒ–æŠ¥å‘Š**ï¼šåŸºäºæ¨¡æ¿çš„è¯¦ç»†æ‰§è¡ŒæŠ¥å‘Šï¼Œæ”¯æŒäº¤æ¥éªŒè¯
- **å®æ—¶ç›‘æ§**ï¼šTmux + Script ç»ˆç«¯å½•åˆ¶ï¼Œæ”¯æŒå®æ—¶é™„åŠ å’Œæ—¥å¿—æŸ¥çœ‹

---

## ç›®å½•

- [ç³»ç»Ÿæ¶æ„](#ç³»ç»Ÿæ¶æ„)
- [ä»£ç æ„æˆ](#ä»£ç æ„æˆ)
- [æ ¸å¿ƒåŠŸèƒ½å®ç°](#æ ¸å¿ƒåŠŸèƒ½å®ç°)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [ä½¿ç”¨æ–¹å¼](#ä½¿ç”¨æ–¹å¼)
- [è¿è¡Œæ—¶æ–‡ä»¶](#è¿è¡Œæ—¶æ–‡ä»¶)
- [é…ç½®è¯´æ˜](#é…ç½®è¯´æ˜)
- [æ•…éšœæ’æŸ¥](#æ•…éšœæ’æŸ¥)

---

## ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                å®¿ä¸»æœº                                         â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ quick-task  â”‚    â”‚   watch.sh  â”‚    â”‚          volumes/               â”‚ â”‚
â”‚  â”‚    .sh      â”‚    â”‚  (ç›‘æ§è„šæœ¬)  â”‚    â”‚  â”œâ”€â”€ commands/pending/          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”œâ”€â”€ reports/pending/           â”‚ â”‚
â”‚         â”‚                  â”‚          â”‚  â”œâ”€â”€ workspace/                  â”‚ â”‚
â”‚         â”‚                  â”‚          â”‚  â”œâ”€â”€ sessions/                   â”‚ â”‚
â”‚         â”‚                  â”‚          â”‚  â”œâ”€â”€ logs/                       â”‚ â”‚
â”‚         â”‚                  â”‚          â”‚  â””â”€â”€ claude-home/                â”‚ â”‚
â”‚         â”‚                  â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                  â”‚                      â”‚
          â”‚    Volume æŒ‚è½½   â”‚     docker exec      â”‚
          â–¼                  â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Docker å®¹å™¨ (host ç½‘ç»œ + GPU)                             â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                        monitor.sh (å…¥å£ç‚¹)                             â”‚ â”‚
â”‚  â”‚                               â”‚                                       â”‚ â”‚
â”‚  â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚ â”‚
â”‚  â”‚                  â–¼                         â–¼                         â”‚ â”‚
â”‚  â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚ â”‚
â”‚  â”‚          â”‚  inotify    â”‚           â”‚  session.sh â”‚                  â”‚ â”‚
â”‚  â”‚          â”‚  (æ–‡ä»¶ç›‘å¬)  â”‚           â”‚  + æ—¥å¿—è§£æ  â”‚                  â”‚ â”‚
â”‚  â”‚          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚ â”‚
â”‚  â”‚                 â”‚                                                    â”‚ â”‚
â”‚  â”‚                 â–¼                                                    â”‚ â”‚
â”‚  â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚ â”‚
â”‚  â”‚          â”‚              Tmux Session                 â”‚              â”‚ â”‚
â”‚  â”‚          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚              â”‚ â”‚
â”‚  â”‚          â”‚  â”‚  Claude Code                        â”‚  â”‚              â”‚ â”‚
â”‚  â”‚          â”‚  â”‚  --debug-file                       â”‚  â”‚              â”‚ â”‚
â”‚  â”‚          â”‚  â”‚  --session-id                       â”‚  â”‚              â”‚ â”‚
â”‚  â”‚          â”‚  â”‚  --permission-mode bypassPermissionsâ”‚  â”‚              â”‚ â”‚
â”‚  â”‚          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚              â”‚ â”‚
â”‚  â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    è·¨æ™ºèƒ½ä½“è®°å¿†ç®¡ç†ç³»ç»Ÿ                                 â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚  â”‚ AGENT_MISSION.mdâ”‚  â”‚  .clauderc      â”‚  â”‚  validate_handover  â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  (ä»»åŠ¡æ‰‹å†Œ)      â”‚  â”‚  (è¡Œä¸ºçº¦æŸ)     â”‚  â”‚  (äº¤æ¥éªŒè¯è„šæœ¬)     â”‚   â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â”‚  GPU: NVIDIA CUDA 12.1 | ~/.claude/projects/ (jsonl ä¼šè¯æ–‡ä»¶)              â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä»£ç æ„æˆ

### ç›®å½•ç»“æ„

```
codingAgent/
â”œâ”€â”€ docker/
â”‚   â”œâ”€â”€ Dockerfile              # å®¹å™¨é•œåƒå®šä¹‰ (NVIDIA CUDA 12.1)
â”‚   â”œâ”€â”€ docker-compose.yml      # å®¹å™¨ç¼–æ’é…ç½® (GPU æ”¯æŒ)
â”‚   â”œâ”€â”€ templates/              # æ¨¡æ¿æ–‡ä»¶ç›®å½•
â”‚   â”‚   â”œâ”€â”€ AGENT_MISSION.md    # ä»»åŠ¡æŒ‡æŒ¥æ‰‹å†Œæ¨¡æ¿
â”‚   â”‚   â”œâ”€â”€ .clauderc           # Claude Code è¡Œä¸ºçº¦æŸé…ç½®
â”‚   â”‚   â”œâ”€â”€ report.md           # è¯¦ç»†æŠ¥å‘Šæ¨¡æ¿
â”‚   â”‚   â”œâ”€â”€ validate_handover.py# äº¤æ¥éªŒè¯è„šæœ¬
â”‚   â”‚   â”œâ”€â”€ decisions/
â”‚   â”‚   â”‚   â””â”€â”€ ADR-0000-template.md
â”‚   â”‚   â””â”€â”€ context/            # å±‚çº§åŒ–ä¸Šä¸‹æ–‡ç³»ç»Ÿ
â”‚   â”‚       â”œâ”€â”€ combine_context.py  # ä¸Šä¸‹æ–‡ç»„åˆè„šæœ¬
â”‚   â”‚       â”œâ”€â”€ global/         # å…¨å±€ä¸Šä¸‹æ–‡
â”‚   â”‚       â”œâ”€â”€ project/        # é¡¹ç›®ä¸Šä¸‹æ–‡
â”‚   â”‚       â””â”€â”€ task/           # ä»»åŠ¡ä¸Šä¸‹æ–‡
â”‚   â””â”€â”€ context/                # (åŒä¸Šï¼Œæ„å»ºæ—¶å¤åˆ¶)
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ container/
â”‚   â”‚   â”œâ”€â”€ monitor.sh          # ä¸»ç›‘æ§è„šæœ¬ (æ ¸å¿ƒ)
â”‚   â”‚   â””â”€â”€ session.sh          # ä¼šè¯ç®¡ç† + æ—¥å¿—è§£æ
â”‚   â”œâ”€â”€ host/
â”‚   â”‚   â””â”€â”€ extract.sh          # å®¿ä¸»æœºæŠ¥å‘Šæå–
â”‚   â”œâ”€â”€ quick-task.sh           # å¿«é€Ÿåˆ›å»ºä»»åŠ¡
â”‚   â””â”€â”€ watch.sh                # å®æ—¶ç›‘æ§
â”œâ”€â”€ volumes/                    # æ•°æ®æŒä¹…åŒ–ç›®å½•
â”‚   â”œâ”€â”€ commands/               # æŒ‡ä»¤æ–‡ä»¶
â”‚   â”œâ”€â”€ reports/                # æ‰§è¡ŒæŠ¥å‘Š
â”‚   â”œâ”€â”€ workspace/              # å·¥ä½œåŒº
â”‚   â”‚   â””â”€â”€ .context/           # é¡¹ç›®çº§ä¸Šä¸‹æ–‡ (å¯é€‰)
â”‚   â”œâ”€â”€ sessions/               # ä¼šè¯çŠ¶æ€ JSON
â”‚   â”œâ”€â”€ logs/                   # è¿è¡Œæ—¥å¿—
â”‚   â””â”€â”€ claude-home/            # Claude Code ä¼šè¯æ•°æ® (jsonl)
â”œâ”€â”€ config/
â”‚   â””â”€â”€ settings.json           # ç³»ç»Ÿé…ç½®
â”œâ”€â”€ advice/                     # è®¾è®¡æ–¹æ¡ˆæ–‡æ¡£
â”œâ”€â”€ .env                        # ç¯å¢ƒå˜é‡
â”œâ”€â”€ .env.example                # ç¯å¢ƒå˜é‡æ¨¡æ¿
â””â”€â”€ README.md
```

### æ ¸å¿ƒæ–‡ä»¶è¯´æ˜

| æ–‡ä»¶ | è¡Œæ•° | åŠŸèƒ½æè¿° |
|------|------|----------|
| `docker/Dockerfile` | ~90 | å®¹å™¨é•œåƒï¼šNVIDIA CUDA 12.1 + Node.js 20 + Claude Code |
| `docker/docker-compose.yml` | ~80 | å®¹å™¨ç¼–æ’ï¼šGPU é…ç½®ã€å·æŒ‚è½½ã€ç½‘ç»œé…ç½® |
| `docker/templates/AGENT_MISSION.md` | ~60 | ä»»åŠ¡æŒ‡æŒ¥æ‰‹å†Œæ¨¡æ¿ |
| `docker/templates/.clauderc` | ~10 | Claude Code è¡Œä¸ºçº¦æŸé…ç½® |
| `docker/templates/report.md` | ~45 | è¯¦ç»†æ‰§è¡ŒæŠ¥å‘Šæ¨¡æ¿ |
| `docker/templates/validate_handover.py` | ~140 | äº¤æ¥éªŒè¯è„šæœ¬ |
| `scripts/container/monitor.sh` | ~580 | **ä¸»ç›‘æ§è„šæœ¬**ï¼šç›‘å¬æŒ‡ä»¤ã€æ‰§è¡Œä»»åŠ¡ã€ç”ŸæˆæŠ¥å‘Š |
| `scripts/container/session.sh` | ~220 | **ä¼šè¯ç®¡ç†**ï¼šä¼šè¯çŠ¶æ€ + jsonl æ—¥å¿—è§£æ |

---

## æ ¸å¿ƒåŠŸèƒ½å®ç°

### 1. GPU æ”¯æŒ

åŸºäº NVIDIA CUDA 12.1 è¿è¡Œæ—¶é•œåƒï¼Œæ”¯æŒæ·±åº¦å­¦ä¹ ä»»åŠ¡ï¼š

```dockerfile
# Dockerfile
FROM nvidia/cuda:12.1.0-runtime-ubuntu22.04

# GPU ç¯å¢ƒå˜é‡
ENV NVIDIA_VISIBLE_DEVICES=all
ENV NVIDIA_DRIVER_CAPABILITIES=compute,utility
```

```yaml
# docker-compose.yml
deploy:
  resources:
    reservations:
      devices:
        - driver: nvidia
          count: all
          capabilities: [gpu]
```

éªŒè¯ GPU å¯ç”¨ï¼š
```bash
docker exec claude-code-agent nvidia-smi
```

### 2. è·¨æ™ºèƒ½ä½“è®°å¿†ç®¡ç†

#### AGENT_MISSION.md - ä»»åŠ¡æŒ‡æŒ¥æ‰‹å†Œ

æ¯ä¸ªé¡¹ç›®ç»´æŠ¤ä¸€ä¸ªä»»åŠ¡æ‰‹å†Œï¼Œè®°å½•ï¼š

| æ¨¡å— | å†…å®¹ |
|------|------|
| **é¡¹ç›®æ„¿æ™¯** | æœ€ç»ˆç›®æ ‡ã€æŠ€æœ¯æ ˆã€æ ¸å¿ƒçº¦æŸ |
| **å·¥ä½œè®¡åˆ’** | é˜¶æ®µåˆ’åˆ†ã€å½“å‰è¿›åº¦ |
| **å®æ–½è¿›åº¦è¿½è¸ª** | å„æ¨¡å—å®ŒæˆçŠ¶æ€ |
| **é¿å‘æŒ‡å—** | å¤±è´¥å°è¯•å’Œè§£å†³æ–¹æ¡ˆ |
| **ä¸‹ä¸€æ­¥æŒ‡ä»¤** | ä¸ºä¸‹ä¸€ä¸ªæ™ºèƒ½ä½“é¢„ç•™ä»»åŠ¡ |

#### .clauderc - è¡Œä¸ºçº¦æŸ

å¼ºåˆ¶ Claude éµå®ˆçš„è§„åˆ™ï¼š

```json
{
  "systemPrompt": "ä½ æ˜¯è¿™ä¸ªé•¿æœŸé¡¹ç›®çš„ç»´æŠ¤è€…ã€‚ä½ çš„è¡Œä¸ºå‡†åˆ™å¦‚ä¸‹ï¼š
1. æ–‡æ¡£å…ˆäºä»£ç ï¼šåœ¨ä¿®æ”¹ä»»ä½•æ ¸å¿ƒé€»è¾‘å‰ï¼Œå…ˆæ£€æŸ¥ AGENT_MISSION.md
2. è®°å½•å¤±è´¥ï¼šå¦‚æœå°è¯•ä¸€ä¸ªä¿®å¤æ–¹æ¡ˆå¤±è´¥äº†ï¼Œå¿…é¡»è®°å½•åœ¨é¿å‘æŒ‡å—ä¸­
3. å¼ºåˆ¶æ›´æ–°ï¼šä»»åŠ¡ç»“æŸå‰ï¼Œå¿…é¡»æ›´æ–°å®æ–½è¿›åº¦å’Œä¸‹ä¸€æ­¥æŒ‡ä»¤
4. ADR è§¦å‘ï¼šæ¶æ„å˜åŠ¨æˆ–å¤æ‚ Bug ä¿®å¤æ—¶ï¼Œåˆ›å»º ADR æ–‡æ¡£"
}
```

#### ADR æ¶æ„å†³ç­–è®°å½•

å¯¹äºå¤æ‚çš„ä»£ç æ”¹åŠ¨ï¼Œè‡ªåŠ¨ç”Ÿæˆ ADR æ–‡æ¡£ï¼š

```markdown
# ADR-NNNN: å†³ç­–æ ‡é¢˜
- **ä¸Šä¸‹æ–‡**: é‡åˆ°äº†ä»€ä¹ˆé—®é¢˜
- **å¤±è´¥çš„å°è¯•**: è¯•è¿‡ä½†æ— æ•ˆçš„æ–¹æ¡ˆ
- **æœ€ç»ˆå†³ç­–**: é€‰æ‹©çš„æ–¹æ¡ˆ
- **åæœ**: å‰¯ä½œç”¨å’Œæ³¨æ„äº‹é¡¹
```

#### äº¤æ¥éªŒè¯è„šæœ¬

ä»»åŠ¡å®Œæˆåè‡ªåŠ¨è¿è¡ŒéªŒè¯ï¼š

```bash
python3 /app/scripts/validate_handover.py
```

æ£€æŸ¥é¡¹ï¼š
- AGENT_MISSION.md å­˜åœ¨æ€§å’Œå®Œæ•´æ€§
- å¿…è¦ç« èŠ‚æ˜¯å¦å­˜åœ¨
- æ˜¯å¦æœ‰å¾…åŠäº‹é¡¹
- Git å·¥ä½œåŒºçŠ¶æ€

### 3. å±‚çº§åŒ–ä¸Šä¸‹æ–‡ç®¡ç†

é€šè¿‡ Python è„šæœ¬ç»„åˆä¸åŒå±‚çº§çš„ä¸Šä¸‹æ–‡ï¼Œç»Ÿä¸€æ³¨å…¥åˆ°ä»»åŠ¡æè¿°å‰ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Global çº§ (docker/context/global/)             â”‚
â”‚  â”œâ”€â”€ coding-standards.md    ç¼–ç è§„èŒƒ            â”‚
â”‚  â””â”€â”€ tool-usage.md          å·¥å…·ä½¿ç”¨æŒ‡å—        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Project çº§ (workspace/.context/ æˆ– context/project/) â”‚
â”‚  â”œâ”€â”€ project-overview.md    é¡¹ç›®æ¦‚è¿°            â”‚
â”‚  â””â”€â”€ architecture.md        æ¶æ„è®¾è®¡            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Task çº§ (context/task/<task-id>/)              â”‚
â”‚  â””â”€â”€ *.md                   ä»»åŠ¡ç‰¹å®šä¸Šä¸‹æ–‡      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  combine_context.py â†’ ç»„åˆ â†’ æ³¨å…¥åˆ°ä»»åŠ¡æè¿°å‰   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ä¸Šä¸‹æ–‡å±‚çº§è¯´æ˜

| å±‚çº§ | ç›®å½• | ç”¨é€” | ç¤ºä¾‹å†…å®¹ |
|------|------|------|----------|
| **Global** | `context/global/` | æ‰€æœ‰é¡¹ç›®é€šç”¨ | ç¼–ç è§„èŒƒã€å·¥å…·ä½¿ç”¨ã€å®‰å…¨è§„åˆ™ |
| **Project** | `workspace/.context/` æˆ– `context/project/` | ç‰¹å®šé¡¹ç›® | é¡¹ç›®æ¶æ„ã€æŠ€æœ¯æ ˆã€API æ–‡æ¡£ |
| **Task** | `context/task/<task-id>/` | ç‰¹å®šä»»åŠ¡ | ç›¸å…³ä»£ç ç‰‡æ®µã€å‚è€ƒæ–‡æ¡£ |

#### ä¸Šä¸‹æ–‡æ–‡ä»¶æ ¼å¼

æ”¯æŒ YAML Frontmatterï¼š

```markdown
---
title: ç¼–ç è§„èŒƒ
priority: 10          # ä¼˜å…ˆçº§ï¼Œæ•°å­—è¶Šå¤§è¶Šé å‰
tags: [coding, standards]  # æ ‡ç­¾ï¼Œå¯ç”¨äºè¿‡æ»¤
enabled: true         # æ˜¯å¦å¯ç”¨
---

## ç¼–ç è§„èŒƒå†…å®¹...

1. ä½¿ç”¨æœ‰æ„ä¹‰çš„å˜é‡å
2. ä¿æŒå‡½æ•°ç®€æ´
```

#### å‘½ä»¤è¡Œä½¿ç”¨

```bash
# ç»„åˆæ‰€æœ‰å±‚çº§ä¸Šä¸‹æ–‡
python3 /app/templates/context/combine_context.py --task-id task-001

# åªç»„åˆç‰¹å®šå±‚çº§
python3 /app/templates/context/combine_context.py --levels global,project

# æŒ‰æ ‡ç­¾è¿‡æ»¤
python3 /app/templates/context/combine_context.py --tags python,api

# åˆ—å‡ºæ‰€æœ‰ä¸Šä¸‹æ–‡æ–‡ä»¶
python3 /app/templates/context/combine_context.py --list-levels

# éªŒè¯ä¸Šä¸‹æ–‡æ–‡ä»¶
python3 /app/templates/context/combine_context.py --validate

# æ³¨å…¥åˆ°ä»»åŠ¡æ–‡ä»¶
python3 /app/templates/context/combine_context.py --inject task.md --output combined.md
```

#### è‡ªåŠ¨æ³¨å…¥æµç¨‹

monitor.sh åœ¨æ‰§è¡Œä»»åŠ¡å‰è‡ªåŠ¨æ‰§è¡Œï¼š

```
1. æ£€æµ‹ä»»åŠ¡ ID
2. è¿è¡Œ combine_context.py ç»„åˆä¸Šä¸‹æ–‡
3. å¦‚æœæœ‰æœ‰æ•ˆä¸Šä¸‹æ–‡ï¼Œæ³¨å…¥åˆ°ä»»åŠ¡æè¿°å‰
4. å°†å®Œæ•´å†…å®¹ä¼ é€’ç»™ Claude Code
```

#### é¡¹ç›®çº§ä¸Šä¸‹æ–‡

é¡¹ç›®çº§ä¸Šä¸‹æ–‡å¯ä»¥æ”¾åœ¨ä¸¤ä¸ªä½ç½®ï¼š

1. **å®¹å™¨å†…ç½®**ï¼š`docker/context/project/` - æ„å»ºæ—¶å›ºå®š
2. **è¿è¡Œæ—¶åŠ¨æ€**ï¼š`workspace/.context/` - å¯åœ¨è¿è¡Œæ—¶ä¿®æ”¹

è¿è¡Œæ—¶ç›®å½•ä¼˜å…ˆçº§æ›´é«˜ï¼Œä¾¿äºåœ¨ä»»åŠ¡ä¸­åŠ¨æ€è°ƒæ•´é¡¹ç›®ä¸Šä¸‹æ–‡ã€‚

#### ç»„åˆåçš„è¾“å‡ºæ ¼å¼

```markdown
# ğŸ“‹ ç»„åˆä¸Šä¸‹æ–‡ (Combined Context)

> ç”Ÿæˆæ—¶é—´: 2026-02-22T10:00:00Z
> ä»»åŠ¡ ID: task-001

---

## ğŸŒ å…¨å±€ä¸Šä¸‹æ–‡ (Global Context)

### ç¼–ç è§„èŒƒ
> æ¥æº: coding-standards.md
[å†…å®¹...]

### å·¥å…·ä½¿ç”¨æŒ‡å—
> æ¥æº: tool-usage.md
[å†…å®¹...]

---

## ğŸ“ é¡¹ç›®ä¸Šä¸‹æ–‡ (Project Context)

### é¡¹ç›®æ¦‚è¿°
> æ¥æº: project-overview.md
[å†…å®¹...]

---

**ä»¥ä¸‹æ˜¯æ‚¨çš„å…·ä½“ä»»åŠ¡ï¼š**

[åŸå§‹ä»»åŠ¡æè¿°...]
```

### 4. ç»“æ„åŒ–æŠ¥å‘Šç”Ÿæˆ

ä»»åŠ¡å®Œæˆåï¼Œå¼ºåˆ¶ç”Ÿæˆè¯¦ç»†æŠ¥å‘Šï¼ŒåŒ…å«ä»¥ä¸‹ç« èŠ‚ï¼š

| ç« èŠ‚ | å†…å®¹ |
|------|------|
| **1. ä»»åŠ¡æ¦‚è§ˆ** | åŸå§‹æŒ‡ä»¤ã€Mission é˜¶æ®µå…³è”ã€æ‰§è¡ŒçŠ¶æ€ |
| **2. æ ¸å¿ƒæˆæœ** | æ–‡ä»¶å˜æ›´ã€åŠŸèƒ½å®ç°ã€éªŒè¯ç»“æœ |
| **3. ADR & å†³ç­–åŒæ­¥** | æŠ€æœ¯å†³ç­–è®°å½• |
| **4. å¡«å‘è®°å½•ä¸é£é™©é¢„è­¦** | é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ |
| **5. Mission æ‰‹å†Œæ›´æ–°è¯´æ˜** | è¿›åº¦æ›´æ–°ã€ä¸‹ä¸€æ‰‹å»ºè®® |
| **6. åŸå§‹æ‰§è¡ŒæŒ‡çº¹** | Git ä¿¡æ¯ã€æ—¥å¿—è·¯å¾„ |
| **é™„å½•** | é¡¹ç›®æŠ€æœ¯è¯¦æƒ…ã€å¼•ç”¨ä¿¡æ¯ |

æŠ¥å‘Šç”Ÿæˆæµç¨‹ï¼š
```
ä»»åŠ¡æ‰§è¡Œ â†’ æ€»ç»“é˜¶æ®µ â†’ è¯¦ç»†æŠ¥å‘Šç”Ÿæˆ â†’ äº¤æ¥éªŒè¯ â†’ åˆå¹¶åŸå§‹æ•°æ®
```

### 4. ä¼šè¯ç®¡ç†ä¸æ—¥å¿—è§£æ

ä» Claude Code çš„ jsonl ä¼šè¯æ–‡ä»¶ä¸­æå–å®Œæ•´ä¿¡æ¯ï¼š

```bash
# æå– AI æ€è€ƒè¿‡ç¨‹
extract_thinking() {
    jq -r 'select(.type == "assistant") | .message.content[]? |
           select(.type == "thinking") | .thinking' "$jsonl_file"
}

# æå–å·¥å…·è°ƒç”¨è®°å½•
extract_tool_uses() {
    jq -c 'select(.type == "assistant") | .message.content[]? |
           select(.type == "tool_use") | {name, id, input}' "$jsonl_file"
}
```

### 5. å·æŒ‚è½½æ–¹æ¡ˆ

| å®¿ä¸»æœºè·¯å¾„ | å®¹å™¨å†…è·¯å¾„ | ç”¨é€” |
|-----------|-----------|------|
| `volumes/commands` | `/app/volumes/commands` | æŒ‡ä»¤æ–‡ä»¶ |
| `volumes/reports` | `/app/volumes/reports` | æ‰§è¡ŒæŠ¥å‘Š |
| `volumes/workspace` | `/app/volumes/workspace` | å·¥ä½œåŒº |
| `volumes/sessions` | `/app/volumes/sessions` | ä¼šè¯çŠ¶æ€ JSON |
| `volumes/logs` | `/app/volumes/logs` | è¿è¡Œæ—¥å¿— |
| `volumes/claude-home` | `/home/node/.claude` | Claude ä¼šè¯æ•°æ® |

> **æ³¨æ„**ï¼šç»‘å®šæŒ‚è½½ä¸ä¼šå¯¼è‡´ç©ºé—´ç¿»å€ï¼Œå®¿ä¸»æœºå’Œå®¹å™¨å…±äº«åŒä¸€ä»½ç‰©ç†å­˜å‚¨ã€‚

---

## å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

```bash
# å…‹éš†é¡¹ç›®
cd /path/to/codingAgent

# é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
vim .env  # å¡«å…¥ API é…ç½®
```

### 2. æ„å»ºå’Œå¯åŠ¨

```bash
cd docker
docker compose build
docker compose up -d
```

### 3. éªŒè¯è¿è¡Œ

```bash
# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker logs claude-code-agent

# éªŒè¯ GPU
docker exec claude-code-agent nvidia-smi

# æœŸæœ›è¾“å‡ºï¼š
# [INFO] === Claude Code Monitor Starting ===
# [INFO] Claude Code version: 2.1.50
# [INFO] Using inotify for file watching
```

### 4. åˆ›å»ºæµ‹è¯•ä»»åŠ¡

```bash
./quick-task.sh "å…‹éš† https://github.com/sunshangquan/Histoformer.git å¹¶åˆ†æé¡¹ç›®ç»“æ„"
```

### 5. æŸ¥çœ‹ç»“æœ

```bash
# æŸ¥çœ‹è¯¦ç»†æŠ¥å‘Š
cat volumes/reports/pending/report-*.md

# æŸ¥çœ‹ AGENT_MISSION.md
cat volumes/workspace/AGENT_MISSION.md
```

---

## ä½¿ç”¨æ–¹å¼

### æŒ‡ä»¤ç±»å‹

| command_type | session_id | è¯´æ˜ |
|--------------|------------|------|
| `new` | `auto` æˆ–ç•™ç©º | åˆ›å»ºæ–°ä¼šè¯ |
| `continue` | å…·ä½“ä¼šè¯ ID | ç»§ç»­å¯¹è¯ |
| `end` | å…·ä½“ä¼šè¯ ID | ç»“æŸä¼šè¯ |

### å¿«æ·è„šæœ¬

```bash
# quick-task.sh - åˆ›å»ºä»»åŠ¡
./quick-task.sh "ä»»åŠ¡æè¿°"              # æ–°ä¼šè¯
./quick-task.sh "ç»§ç»­ä»»åŠ¡" <session_id>  # ç»§ç»­ä¼šè¯

# watch.sh - å®æ—¶ç›‘æ§
./watch.sh --status   # çŠ¶æ€æ¦‚è§ˆ
./watch.sh --tail     # å®æ—¶æ—¥å¿—
./watch.sh --attach   # é™„åŠ åˆ° Tmux ç»ˆç«¯ (Ctrl+B D é€€å‡º)
```

### å¤šè½®å¯¹è¯ç¤ºä¾‹

```bash
# ç¬¬ä¸€è½®ï¼šåˆ›å»ºæ–°ä¼šè¯
./quick-task.sh "åˆ›å»ºé¡¹ç›®ç»“æ„ï¼ŒåŒ…å« src å’Œ tests ç›®å½•"

# æŸ¥çœ‹æŠ¥å‘Šè·å– session_id
grep "session_id" volumes/reports/pending/report-*.md | tail -1

# ç¬¬äºŒè½®ï¼šç»§ç»­å¯¹è¯
./quick-task.sh "åœ¨ src ç›®å½•åˆ›å»º main.py" abc-123-def

# ç»“æŸä¼šè¯
echo "---
id: end-001
session_id: abc-123-def
command_type: end
---
ç»“æŸ" > volumes/commands/pending/end.md
```

### Docker ç®¡ç†å‘½ä»¤

```bash
# æŸ¥çœ‹æ—¥å¿—
docker logs -f claude-code-agent

# éªŒè¯ GPU
docker exec claude-code-agent nvidia-smi

# è¿›å…¥å®¹å™¨
docker exec -it claude-code-agent bash

# é™„åŠ åˆ° Claude ç»ˆç«¯
docker exec -it claude-code-agent tmux attach -t claude_session

# é‡å¯å®¹å™¨
docker compose restart

# å®Œå…¨é‡å»ºï¼ˆæ¸…ç©ºæ•°æ®ï¼‰
docker compose down -v && docker compose build && docker compose up -d
```

---

## è¿è¡Œæ—¶æ–‡ä»¶

### ç”Ÿæˆçš„æ–‡ä»¶

| æ–‡ä»¶ | ä½ç½® | è¯´æ˜ |
|------|------|------|
| **æŒ‡ä»¤æ–‡ä»¶** | `volumes/commands/pending/*.md` | ç”¨æˆ·åˆ›å»ºçš„ä»»åŠ¡ |
| **å·²å¤„ç†æŒ‡ä»¤** | `volumes/commands/processed/*.md` | æ‰§è¡Œå®Œæˆåç§»åŠ¨è‡³æ­¤ |
| **æŠ¥å‘Šæ–‡ä»¶** | `volumes/reports/pending/report-*.md` | è¯¦ç»†æ‰§è¡ŒæŠ¥å‘Š |
| **AGENT_MISSION.md** | `volumes/workspace/AGENT_MISSION.md` | ä»»åŠ¡æŒ‡æŒ¥æ‰‹å†Œ |
| **ADR æ–‡æ¡£** | `volumes/workspace/docs/decisions/ADR-*.md` | æ¶æ„å†³ç­–è®°å½• |
| **ä¼šè¯çŠ¶æ€** | `volumes/sessions/<uuid>.json` | ä¼šè¯å…ƒæ•°æ® |
| **è°ƒè¯•æ—¥å¿—** | `volumes/logs/debug-*.log` | Claude Code è°ƒè¯•ä¿¡æ¯ |
| **ä¼šè¯ jsonl** | `volumes/claude-home/projects/**/*.jsonl` | å®Œæ•´ä¼šè¯æ•°æ® |

### è¯¦ç»†æŠ¥å‘Šæ ¼å¼

```markdown
---
session_id: "xxx"
report_date: "2026-02-22T15:30:00Z"
status: "SUCCESS"
tags: [deep-learning, pytorch]
---

# æ‰§è¡Œä»»åŠ¡æ€»ç»“æŠ¥å‘Š

## 1. ä»»åŠ¡æ¦‚è§ˆ (Task Overview)
- **åŸå§‹æŒ‡ä»¤**: [ä»»åŠ¡æè¿°]
- **å…³è” Mission é˜¶æ®µ**: [x] é˜¶æ®µ 2: æ ¸å¿ƒé€»è¾‘å¼€å‘
- **æ‰§è¡ŒçŠ¶æ€**: SUCCESS

## 2. æ ¸å¿ƒæˆæœ (Key Deliverables)
- **æ–‡ä»¶å˜æ›´**: [æ–‡ä»¶åˆ—è¡¨å’Œå˜æ›´å†…å®¹]
- **åŠŸèƒ½å®ç°**: [å®ç°çš„åŠŸèƒ½]
- **éªŒè¯ç»“æœ**: [æµ‹è¯•ç»“æœ]

## 3. ADR & å†³ç­–åŒæ­¥ (Architectural Decisions)
- **å†³ç­–å†…å®¹**: [æŠ€æœ¯å†³ç­–]
- **ç†ç”±**: [ä¸ºä»€ä¹ˆåšè¿™ä¸ªå†³ç­–]

## 4. å¡«å‘è®°å½•ä¸é£é™©é¢„è­¦ (Pitfalls & Lessons)
- **é‡åˆ°çš„é—®é¢˜**: [é—®é¢˜æè¿°]
- **å¤±è´¥å°è¯•**: [å°è¯•è¿‡ä½†å¤±è´¥çš„æ–¹æ³•]
- **æœ€ç»ˆæ–¹æ¡ˆ**: [æˆåŠŸçš„è§£å†³æ–¹æ¡ˆ]
- **æ®‹ç•™é£é™©**: [æ³¨æ„äº‹é¡¹]

## 5. Mission æ‰‹å†Œæ›´æ–°è¯´æ˜ (Mission Sync)
- **è¿›åº¦æ›´æ–°**: [æ›´æ–°çš„è¿›åº¦]
- **ä¸‹ä¸€æ‰‹å»ºè®®**: [å…·ä½“ä»»åŠ¡å»ºè®®]

## 6. åŸå§‹æ‰§è¡ŒæŒ‡çº¹ (Artifacts)
- **Git Commit**: [commit hash]
- **ç›¸å…³æ—¥å¿—**: [æ—¥å¿—è·¯å¾„]
```

---

## é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡ (.env)

| å˜é‡ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|------|
| `ANTHROPIC_BASE_URL` | æ˜¯ | API åŸºç¡€ URL | `https://api.anthropic.com` |
| `ANTHROPIC_AUTH_TOKEN` | æ˜¯ | è®¤è¯ Token | `sk-ant-xxx` |
| `ANTHROPIC_MODEL` | å¦ | æ¨¡å‹åç§° | `claude-sonnet-4-6` |

### settings.json

```json
{
  "monitor": {
    "poll_interval_ms": 1000,
    "use_inotify": true
  },
  "session": {
    "timeout_minutes": 30,
    "max_turns": 100
  },
  "paths": {
    "commands": "/app/volumes/commands",
    "reports": "/app/volumes/reports",
    "workspace": "/app/volumes/workspace",
    "sessions": "/app/volumes/sessions"
  },
  "logging": {
    "level": "info"
  }
}
```

---

## æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

| é—®é¢˜ | è§£å†³æ–¹æ¡ˆ |
|------|----------|
| å®¹å™¨æ— æ³•å¯åŠ¨ | æ£€æŸ¥ `.env` æ–‡ä»¶å’Œ API Token |
| GPU ä¸å¯ç”¨ | ç¡®ä¿ nvidia-docker å·²å®‰è£…ï¼Œè¿è¡Œ `docker exec ... nvidia-smi` |
| æŒ‡ä»¤æœªæ‰§è¡Œ | ç¡®è®¤æ–‡ä»¶åœ¨ `pending/` ç›®å½•ä¸”æ ¼å¼æ­£ç¡® |
| ç½‘ç»œè¶…æ—¶ | æ£€æŸ¥ä»£ç†é…ç½® (`127.0.0.1:7890`) |
| æƒé™é”™è¯¯ | è¿è¡Œ `chown -R 1000:1000 volumes/` |
| thinking ä¸ºç©º | æ¨¡å‹å¯èƒ½ä¸æ”¯æŒï¼Œæˆ– jsonl è·¯å¾„é—®é¢˜ |

### è°ƒè¯•å‘½ä»¤

```bash
# æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker ps -a | grep claude

# éªŒè¯ GPU
docker exec claude-code-agent nvidia-smi

# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker logs claude-code-agent --tail 100

# æŸ¥çœ‹è°ƒè¯•æ—¥å¿—
tail -f volumes/logs/debug-*.log

# æ£€æŸ¥ä¼šè¯ jsonl æ–‡ä»¶
ls -la volumes/claude-home/projects/*/

# æ£€æŸ¥ AGENT_MISSION.md
cat volumes/workspace/AGENT_MISSION.md
```

### æ—¥å¿—æ¸…ç†

```bash
# æ¸…ç†æ—§æ—¥å¿— (7å¤©å‰)
find volumes/logs -name "*.log" -mtime +7 -delete

# æ¸…ç†æ—§ä¼šè¯æ•°æ® (30å¤©å‰)
find volumes/claude-home -name "*.jsonl" -mtime +30 -delete
```

---

## æŠ€æœ¯æ ˆ

| ç»„ä»¶ | ç‰ˆæœ¬/è¯´æ˜ |
|------|----------|
| Docker | å®¹å™¨è¿è¡Œæ—¶ |
| NVIDIA CUDA | 12.1.0-runtime |
| Node.js | 20 |
| Claude Code CLI | @anthropic-ai/claude-code |
| Python | 3.10 |
| Tmux | ç»ˆç«¯å¤ç”¨ |
| inotify-tools | æ–‡ä»¶ç›‘æ§ |
| jq | JSON å¤„ç† |

---

## æ³¨æ„äº‹é¡¹

1. **GPU è¦æ±‚**ï¼šéœ€è¦å®¿ä¸»æœºå®‰è£… NVIDIA é©±åŠ¨å’Œ nvidia-docker
2. **ç½‘ç»œæ¨¡å¼**ï¼šä½¿ç”¨ `host` ç½‘ç»œæ¨¡å¼ï¼Œå®¹å™¨å¯ç›´æ¥è®¿é—®å®¿ä¸»æœºä»£ç† `127.0.0.1:7890`
3. **ç”¨æˆ·æƒé™**ï¼šå®¹å™¨ä»¥ `node` ç”¨æˆ·è¿è¡Œ (UID 1000)ï¼Œéœ€ç¡®ä¿ volume ç›®å½•æƒé™æ­£ç¡®
4. **æƒé™æ¨¡å¼**ï¼šä½¿ç”¨ `bypassPermissions` å®ç°è‡ªåŠ¨åŒ–ï¼Œé€‚åˆæ²™ç®±ç¯å¢ƒ
5. **ä¼šè¯æŒä¹…åŒ–**ï¼šä¼šè¯æ•°æ®é€šè¿‡å·æ˜ å°„æŒä¹…åŒ–åˆ°å®¿ä¸»æœº
6. **æ—¥å¿—å¢é•¿**ï¼šclaude-home ç›®å½•ä¼šéšä½¿ç”¨å¢é•¿ï¼Œå»ºè®®å®šæœŸæ¸…ç†

---

## è¿ç§»æŒ‡å—

### è¿ç§»åˆ°å…¶ä»–å®¿ä¸»æœº

#### 1. åŸºç¡€ç¯å¢ƒå‡†å¤‡

```bash
# å®‰è£… Docker
curl -fsSL https://get.docker.com | sh

# å®‰è£… NVIDIA Container Toolkitï¼ˆGPU æ”¯æŒï¼‰
# Ubuntu/Debian
curl -fsSL https://nvidia.github.io/libnvidia-container/gpgkey | sudo gpg --dearmor -o /usr/share/keyrings/nvidia-container-toolkit-keyring.gpg
curl -s -L https://nvidia.github.io/libnvidia-container/stable/deb/nvidia-container-toolkit.list | \
  sed 's#deb https://#deb [signed-by=/usr/share/keyrings/nvidia-container-toolkit-keyring.gpg] https://#g' | \
  sudo tee /etc/apt/sources.list.d/nvidia-container-toolkit.list
sudo apt-get update && sudo apt-get install -y nvidia-container-toolkit
sudo nvidia-ctk runtime configure --runtime=docker
sudo systemctl restart docker
```

#### 2. å¤åˆ¶é¡¹ç›®æ–‡ä»¶

```bash
# æ–¹å¼ä¸€ï¼šç›´æ¥å¤åˆ¶ç›®å½•
scp -r codingAgent/ user@new-host:/path/to/

# æ–¹å¼äºŒï¼šä½¿ç”¨ git clone
git clone <repository-url> codingAgent
```

#### 3. é€‚é…ä¸åŒç¡¬ä»¶é…ç½®

##### GPU é…ç½®

ç¼–è¾‘ `docker/docker-compose.yml`ï¼š

```yaml
# æ–¹å¼ä¸€ï¼šä½¿ç”¨æ‰€æœ‰ GPU
deploy:
  resources:
    reservations:
      devices:
        - driver: nvidia
          count: all
          capabilities: [gpu]

# æ–¹å¼äºŒï¼šæŒ‡å®šç‰¹å®š GPUï¼ˆå¤šå¡æƒ…å†µï¼‰
deploy:
  resources:
    reservations:
      devices:
        - driver: nvidia
          device_ids: ['0', '1']  # ä½¿ç”¨ GPU 0 å’Œ 1
          capabilities: [gpu]

# æ–¹å¼ä¸‰ï¼šä¸ä½¿ç”¨ GPUï¼ˆçº¯ CPU æ¨¡å¼ï¼‰
# åˆ é™¤æ•´ä¸ª deploy.resources.reservations.devices é…ç½®å—
```

##### ä¿®æ”¹åŸºç¡€é•œåƒï¼ˆä¸åŒ CUDA ç‰ˆæœ¬ï¼‰

ç¼–è¾‘ `docker/Dockerfile` ç¬¬ä¸€è¡Œï¼š

```dockerfile
# NVIDIA RTX 30/40 ç³»åˆ—ï¼Œæ¨è CUDA 12.x
FROM nvidia/cuda:12.1.0-runtime-ubuntu22.04

# NVIDIA RTX 20 ç³»åˆ—ï¼Œå¯èƒ½éœ€è¦ CUDA 11.x
FROM nvidia/cuda:11.8.0-runtime-ubuntu22.04

# çº¯ CPU æ¨¡å¼ï¼ˆæ—  GPUï¼‰
FROM ubuntu:22.04
```

##### èµ„æºé™åˆ¶

ç¼–è¾‘ `docker/docker-compose.yml`ï¼š

```yaml
# æ·»åŠ èµ„æºé™åˆ¶
deploy:
  resources:
    limits:
      cpus: '4'      # æœ€å¤šä½¿ç”¨ 4 æ ¸
      memory: 8G     # æœ€å¤šä½¿ç”¨ 8GB å†…å­˜
    reservations:
      cpus: '1'      # ä¿ç•™ 1 æ ¸
      memory: 1G     # ä¿ç•™ 1GB å†…å­˜
```

##### ç½‘ç»œä»£ç†é…ç½®

ç¼–è¾‘ `docker/docker-compose.yml` ç¯å¢ƒå˜é‡ï¼š

```yaml
environment:
  # å¦‚æœä»£ç†åœ¨å®¿ä¸»æœºä¸Š
  - HTTP_PROXY=http://127.0.0.1:7890
  - HTTPS_PROXY=http://127.0.0.1:7890

  # å¦‚æœä»£ç†åœ¨å…¶ä»–åœ°å€
  - HTTP_PROXY=http://192.168.1.100:7890
  - HTTPS_PROXY=http://192.168.1.100:7890

  # å¦‚æœä¸éœ€è¦ä»£ç†ï¼Œåˆ é™¤è¿™äº›è¡Œ
```

æˆ–è€…ä½¿ç”¨ `host` ç½‘ç»œæ¨¡å¼æ—¶ï¼Œç›´æ¥ä½¿ç”¨å®¿ä¸»æœºçš„ä»£ç†ï¼š

```yaml
network_mode: host  # å®¹å™¨ç›´æ¥ä½¿ç”¨å®¿ä¸»æœºç½‘ç»œ
```

#### 4. é€‚é…ä¸åŒå­˜å‚¨é…ç½®

##### ä¿®æ”¹å·æŒ‚è½½è·¯å¾„

ç¼–è¾‘ `docker/docker-compose.yml`ï¼š

```yaml
volumes:
  # é»˜è®¤é…ç½®ï¼ˆç›¸å¯¹è·¯å¾„ï¼‰
  - ../volumes/commands:/app/volumes/commands

  # ä½¿ç”¨ç»å¯¹è·¯å¾„ï¼ˆå­˜å‚¨åœ¨å…¶ä»–ä½ç½®ï¼‰
  - /data/codingAgent/commands:/app/volumes/commands
  - /mnt/storage/workspace:/app/volumes/workspace
```

##### ä½¿ç”¨ Docker å‘½åå·

```yaml
volumes:
  claude-commands:
  claude-workspace:

services:
  claude-code:
    volumes:
      - claude-commands:/app/volumes/commands
      - claude-workspace:/app/volumes/workspace
```

#### 5. é€‚é…ä¸åŒå¹³å°

##### ARM å¹³å°ï¼ˆå¦‚ Apple Siliconï¼‰

```dockerfile
# Dockerfile ä¿®æ”¹
# æ³¨æ„ï¼šNVIDIA CUDA é•œåƒä¸æ”¯æŒ ARM
# éœ€è¦ä½¿ç”¨åŸºç¡€ Ubuntu é•œåƒ + æ‰‹åŠ¨å®‰è£…

FROM ubuntu:22.04

# å®‰è£… Node.js (ARM ç‰ˆ)
RUN curl -fsSL https://deb.nodesource.com/setup_20.x | bash - && \
    apt-get install -y nodejs
```

##### äº‘æœåŠ¡å™¨éƒ¨ç½²

```yaml
# docker-compose.yml
# äº‘æœåŠ¡å™¨é€šå¸¸éœ€è¦é…ç½®å®‰å…¨ç»„å’Œç«¯å£

services:
  claude-code:
    # ä¸ä½¿ç”¨ host ç½‘ç»œï¼Œä½¿ç”¨æ¡¥æ¥
    networks:
      - claude-network
    ports:
      - "8080:8080"  # å¦‚éœ€æš´éœ²æœåŠ¡ç«¯å£

networks:
  claude-network:
    driver: bridge
```

#### 6. è¿ç§»æ£€æŸ¥æ¸…å•

```bash
# 1. æ£€æŸ¥ GPU é©±åŠ¨
nvidia-smi

# 2. æ£€æŸ¥ Docker
docker --version
docker compose version

# 3. æ£€æŸ¥ NVIDIA Container Toolkit
docker run --rm --gpus all nvidia/cuda:12.1.0-base-ubuntu22.04 nvidia-smi

# 4. æ£€æŸ¥ä»£ç†ï¼ˆå¦‚éœ€è¦ï¼‰
curl -x http://127.0.0.1:7890 https://api.anthropic.com

# 5. æ£€æŸ¥ç›®å½•æƒé™
ls -la volumes/
# ç¡®ä¿ UID 1000 æœ‰å†™æƒé™
chown -R 1000:1000 volumes/

# 6. é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
vim .env

# 7. æ„å»ºå’Œå¯åŠ¨
cd docker
docker compose build
docker compose up -d

# 8. éªŒè¯è¿è¡Œ
docker logs claude-code-agent
docker exec claude-code-agent nvidia-smi
```

#### 7. å¸¸è§ç¡¬ä»¶é€‚é…åœºæ™¯

| åœºæ™¯ | é…ç½®ä¿®æ”¹ |
|------|----------|
| **æ—  GPU æœåŠ¡å™¨** | åˆ é™¤ GPU deploy é…ç½®ï¼Œæ”¹ç”¨ `ubuntu:22.04` åŸºç¡€é•œåƒ |
| **å¤š GPU æœåŠ¡å™¨** | ä½¿ç”¨ `device_ids` æŒ‡å®š GPUï¼Œæˆ– `count: all` |
| **ä½å†…å­˜æœåŠ¡å™¨** | è®¾ç½® `memory: 2G` é™åˆ¶ |
| **é«˜å†…å­˜æœåŠ¡å™¨** | å¢åŠ å†…å­˜é™åˆ¶ï¼Œå¯å¤„ç†æ›´å¤§æ¨¡å‹ |
| **å›½å†…æœåŠ¡å™¨** | é…ç½®å›½å†…ä»£ç†æˆ–ä½¿ç”¨é•œåƒåŠ é€Ÿ |
| **äº‘æœåŠ¡å™¨** | é…ç½®å®‰å…¨ç»„ã€ä½¿ç”¨æ¡¥æ¥ç½‘ç»œ |

## License

MIT
